<!doctype html>
<html lang="en-US">
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="alternate" type="application/rss+xml" title="Subscribe to Abhishek Nagekar's Blog" href="../../index.html?feed=rss2" />
  <link rel="alternate" type="application/atom+xml" title="Subscribe to Abhishek Nagekar's Blog" href="../../index.html?feed=atom" />

	<title>DIY Web Analytics &#8211; Abhishek Nagekar</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<script>
window.koko_analytics = {"url":"https:\/\/nagekar.com\/koko-analytics-collect.php","site_url":"https:\/\/nagekar.com","post_id":1020,"path":"\/2020\/10\/diy-web-analytics.html","method":"none","use_cookie":false};
</script>
<link rel="alternate" type="application/rss+xml" title="Abhishek Nagekar &raquo; Feed" href="../../index.html?feed=rss2" />
<style id='classic-theme-styles-inline-css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='elementary-style-css' href='../../wp-content/themes/s/style.css?ver=1.0.0' media='all' />
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" title="JSON" type="application/json" href="../../wp-json/wp/v2/posts/1020" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://nagekar.com/xmlrpc.php?rsd" />

<link rel="canonical" href="../../index.html?p=1020" />
<link rel='shortlink' href='../../index.html?p=1020' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed?url=https:%252F%252Fnagekar.com%252F2020%252F10%252Fdiy-web-analytics.html" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed?url=https:%252F%252Fnagekar.com%252F2020%252F10%252Fdiy-web-analytics.html&amp;format=xml" />
<link rel="icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-180x180.png" />
<meta name="msapplication-TileImage" content="https://nagekar.com/wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-270x270.png" />
		<style id="wp-custom-css">
			
.quotes-ol-container {
	display: flex;
  flex-direction: column-reverse;
}

.quotes-ol-container li {
	flex: 0 0 auto;
}		</style>
		</head>

<body class="wp-singular post-template-default single single-post postid-1020 single-format-standard wp-theme-s">
<div class="container">
	<nav class="top-nav">
  <details class="nav-details-wrapper">
    <summary>
      <a class="nav-item" href='../../index.html'>Home</a> |
      <a class="nav-item" title="About this blog and me" href='../../about'>About</a> |
      <a class="nav-item" title="Handpicked word art" href='../../quotes'>Quotes</a> |
      <a class="nav-item" title="Buckets of my writing" href='../../tags'>Tags</a> |
      <a class="nav-item" href='https://github.com/abhn'>Github</a> |
      <span class="nav-item" id="nav-details-toggle">More ‚ú®</span>
    </summary>

    <form action="../../index.html" method="get" target="_blank">
  <label for="search-input">‚û°Ô∏è Search for a specific term: </label>
  <input id="search-input" name="s" type="text" placeholder="search term" name="" required>
  <input type="submit" value="Search">
</form>

    <p><label for="dark-mode-toggle">‚û°Ô∏è Toggle dark mode üåó</label>&nbsp;
    <input id="dark-mode-toggle" type="checkbox"/></p>

    <p>‚û°Ô∏è Subscribe via a <a href="https://en.wikipedia.org/wiki/Web_feed">feeds</a> reader: 
      <a href="../../index.html?feed=rss2">RSS</a>,
      <a href="../../index.html?feed=atom">Atom</a></p>

  </details>
</nav>
  <hr class="stylish"/>

<div class="_progress-wrapper">
  <div id="_progress"></div>
</div>

<header>
	<h1>DIY Web Analytics</h1>
	<header class="title-tags">
		<time>11 October, 2020. It was a Sunday</time>
		<div class="tags-container">
			Posted under <span>
										<a class="tags" href="../../tags#javascript">javascript</a>
										<a class="tags" href="../../tags#python">python</a>
										<a class="tags" href="../../tags#web">web</a>
							</span>
			&nbsp;
		</div>
	</header>
</header>

<hr class="stylish" />

<main role="main">

	
		<article>
			<section class="content">
				<p>
  I&#8217;ve long established that adding heavy duty analytics and tracking scripts to my blog pages isn&#8217;t the right thing to do. Personally, it is also a bit liberating to not know which article of mine is getting a lot of traffic and which isn&#8217;t, because then I&#8217;m not biased by what the internet is searching for and can write about pretty much anything that I feel like writing about. <q>10 programming languages you should learn in 2020</q> has exactly the same weight as <q>Let me tell you a funny story from last night</q>, so which one do think I&#8217;d write about?
</p>
<p>
  The analytics and tracking world has come a long way and is viewed very negatively in the light of recent internet incidents. But it started off very simple and had a very simple and non-malicious idea at its core: Getting to know your user better so that you can serve them better.
</p>
<p>
  That thought made me search for a simple analytics solution that I could run on my blog for a couple of weeks and get enough insights to make informed decisions regarding the frontend design changes while not compromising on the privacy of the visitors. If I&#8217;m completely honest, I was also just curious to know these things with no agenda behind it.
</p>
<p>
  I looked into <a href="https://simpleanalytics.com/">Simple Analytics</a>, a nice solution that does exactly what I needed (perhaps a bit more than that), but a little expensive for me at USD 19 a month. There are also self hosted analytics solutions like <a href="https://plausible.io/">Plausible</a>, but that was too much work for realizing this simple thought. So I decided to put something together quickly and the following is what I ended up implementing.
</p>
<h3>Client side JavaScript</h3>
<p>
  On the client side, I needed to get the data that interested me. It was details like the browsers used by my visitors, platform, width of their screens etc. More technically, the user agent, platform, screen width, referrer and the current page&#8217;s url (although I don&#8217;t plan on using it for this article. Spoiler: One of my lowest effort articles is pulling more than half of all pageviews which is a bit saddening).
</p>
<figure class="highlight">
<pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre>
</td>
<td class="code">
<pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="dl">'</span><span class="s1">doNotTrack</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">navigator</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nb">navigator</span><span class="p">.</span><span class="nx">doNotTrack</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">analytics</span> <span class="o">=</span> <span class="p"&gt;{};</span>

  <span class="nx">analytics</span><span class="p">[</span><span class="dl">"</span><span class="s2">href</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p"&gt;;</span>
  <span class="nx">analytics</span><span class="p">[</span><span class="dl">"</span><span class="s2">userAgent</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p"&gt;;</span>
  <span class="nx">analytics</span><span class="p">[</span><span class="dl">"</span><span class="s2">width</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p"&gt;;</span>
  <span class="nx">analytics</span><span class="p">[</span><span class="dl">"</span><span class="s2">referrer</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">referrer</span><span class="p"&gt;;</span>
  <span class="nx">analytics</span><span class="p">[</span><span class="dl">"</span><span class="s2">platform</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="p"&gt;;</span>

  <span class="nb">navigator</span><span class="p">.</span><span class="nx">sendBeacon</span><span class="p">(</span><span class="nx">ANALYTICS_ENDPOINT</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">analytics</span><span class="p"&gt;));</span>
<span class="p">}</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  There&#8217;s not much happening here. Just checking if the user prefers to not be tracked, else get the desired data and POST it to our analytics endpoint using the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon">navigator.sendBeacon</a> API.
</p>
<h3>Server</h3>
<p>
  We need to implement the endpoint that&#8217;s listening for the POST requests from our client browsers. I decided to go with Firebase&#8217;s functions for handling the request and Firebase&#8217;s realtime database to store the data.
</p>
<figure class="highlight">
<pre><code class="language-javascript" data-lang="javascript"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre>
</td>
<td class="code">
<pre><span class="kd">const</span> <span class="nx">functions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-functions</span><span class="dl">'</span><span class="p"&gt;);</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">firebase-admin</span><span class="dl">'</span><span class="p"&gt;);</span>

<span class="nx">admin</span><span class="p">.</span><span class="nx">initializeApp</span><span class="p"&gt;();</span>

<span class="kd">const</span> <span class="nx">cors</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">)({</span>
  <span class="na">origin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p"&gt;});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">handler</span> <span class="o">=</span> <span class="nx">functions</span><span class="p">.</span><span class="nx">https</span><span class="p">.</span><span class="nx">onRequest</span><span class="p">(</span><span class="k">async</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">snapshot</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">admin</span><span class="p">.</span><span class="nx">database</span><span class="p">().</span><span class="nx">ref</span><span class="p">(</span><span class="dl">'</span><span class="s1">/hit</span><span class="dl">'</span><span class="p">).</span><span class="nx">push</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p"&gt;));</span>
    <span class="k">return</span> <span class="nx">cors</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span> <span class="p"&gt;});</span>
    <span class="p"&gt;});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span> <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">have a good day!</span><span class="dl">'</span> <span class="p"&gt;});</span>
  <span class="p">}</span>
<span class="p"&gt;});</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  Now this is super bad code for a variety of reasons, but it worked for my temporary needs. I deployed this, waited for a couple of weeks and had some data to answer some basic questions about my blog&#8217;s visitors.
</p>
<h3>Parsing data</h3>
<p>
  So at this point I had let this code run long enough to have accumulated couple of hundred entries. It was time to analyze. Firebase allows you to easily export the database in JSON format. Using some basic Python-fu, I created lists of each dimension and passed these lists to Python&#8217;s builtin <code>collections.Counter</code> (which is perfect since I&#8217;m only interested in aggregated stats), and then take the top 5 most frequent items using the <code>.most_common</code> method. Finally, we plot bar charts for these top 5 values across each dimension using Matplotlib to visualize the results.
</p>
<figure class="highlight">
<pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre>
</td>
<td class="code">
<pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">user_agents</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">analytics_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">plot_chart_from_ctr</span><span class="p">(</span><span class="n">ctr</span><span class="p">):</span>
    <span class="n">most_common</span> <span class="o">=</span> <span class="n">ctr</span><span class="p">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">most_common</span><span class="p">],</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">most_common</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'export.json'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'hit'</span><span class="p">]</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hit</span><span class="p">:</span>
            <span class="n">entries</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>

        <span class="n">analytics_data</span><span class="p">[</span><span class="s">'height'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">analytics_data</span><span class="p">[</span><span class="s">'width'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'width'</span><span class="p">])</span>
            <span class="n">analytics_data</span><span class="p">[</span><span class="s">'href'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'href'</span><span class="p">])</span>
            <span class="n">analytics_data</span><span class="p">[</span><span class="s">'platform'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'platform'</span><span class="p">])</span>
            <span class="n">analytics_data</span><span class="p">[</span><span class="s">'referrer'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'referrer'</span><span class="p">])</span>
            <span class="n">analytics_data</span><span class="p">[</span><span class="s">'userAgent'</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s">'userAgent'</span><span class="p">])</span>

    <span class="n">browser_family</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">agent</span> <span class="ow">in</span> <span class="n">analytics_data</span><span class="p">[</span><span class="s">'userAgent'</span><span class="p">]:</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">agent</span><span class="p">)</span>
        <span class="n">browser_family</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_agent</span><span class="p">.</span><span class="n">browser</span><span class="p">.</span><span class="n">family</span><span class="p">)</span>

    <span class="n">ctr_browser_family</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">browser_family</span><span class="p">)</span>
    <span class="n">plot_chart_from_ctr</span><span class="p">(</span><span class="n">ctr_browser_family</span><span class="p">)</span>

    <span class="n">ctr_platform</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">analytics_data</span><span class="p">[</span><span class="s">'platform'</span><span class="p">])</span>
    <span class="n">plot_chart_from_ctr</span><span class="p">(</span><span class="n">ctr_platform</span><span class="p">)</span>

    <span class="n">ctr_referrer</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">analytics_data</span><span class="p">[</span><span class="s">'referrer'</span><span class="p">])</span>
    <span class="n">plot_chart_from_ctr</span><span class="p">(</span><span class="n">ctr_referrer</span><span class="p">)</span>

    <span class="n">ctr_width</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">analytics_data</span><span class="p">[</span><span class="s">'width'</span><span class="p">])</span>
    <span class="n">plot_chart_from_ctr</span><span class="p">(</span><span class="n">ctr_width</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">driver</span><span class="p">()</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<h3>The questions</h3>
<h4>What are the most common browsers?</h4>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/analytics-browser.png"/><figcaption>I would&#8217;ve guessed this to be the case for browsers, but not in Chrome&#8217;s favour to this extent üôÅ</figcaption></figure>
<h4>What are the most common platforms?</h4>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/analytics-platform.png"/><figcaption>Win32 is still the majority platform among my visitors and there&#8217;s some Apple action going on. There&#8217;s also a healthy chunk of Linux X86_64 visitors. The armv7l and armv8l may contain Android devices but hard to tell.</figcaption></figure>
<h4>What are the most common referrers?</h4>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/analytics-referrer.png"/><figcaption>Unsurprisingly, most of the traffic comes through Google.</figcaption></figure>
<h4>What are the most common screen widths?</h4>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/analytics-width.png"/><figcaption>There&#8217;s a healthy mix of screen resolutions with the most frequent being 360px.</figcaption></figure>
<h3>In closing</h3>
<p>
  So that&#8217;s it for this little article. I&#8217;m happy with the outcome given how little effort went into this whole assignment. I hope you enjoyed reading it. As always, write me an email in case you have any comments!
</p>
<p>
  Thank you for reading.</p>
			</section>

			<hr class="stylish"/>

			<aside class="featured-posts">
  <h3>Unrelated</h3>
  <ul>
    <li><a href="../../index.html?p=1263">The Best Time Of Your Life Is Right Now</a></li>
    <li><a href="https://nagekar.com/2019/01/mumbai-to-berlin.html">Mumbai To Berlin</a></li>
    <li><a href="https://nagekar.com/2018/03/hum-devs-kab-banenge.html">Hum Developers Kab Banenge?</a></li>
    <li><a href="https://nagekar.com/2016/11/a-visit-to-the-taj-mahal.html">A Visit To The Taj Mahal</a></li>
    <li><a href="https://nagekar.com/2019/05/be-easy-on-yourself.html">Be Easy On Yourself</a></li>
  </ul>
</aside>

			<hr class="stylish"/>

			<section class="pagination">
				
					<a class="prev" href="../../index.html?p=1021">&laquo; A Tale Of Internet Speeds</a>

					
					<a class="next" href="../../index.html?p=1019"> Become A 10x &lt;anything&gt; [fail] &raquo;</a>

								</section>

		</article>

	
</main><!-- #main -->


</div>

<footer>
  <hr class="stylish"/>
  <nav class="top-nav">
  <details class="nav-details-wrapper">
    <summary>
      <a class="nav-item" href='../../index.html'>Home</a> |
      <a class="nav-item" title="About this blog and me" href='../../about'>About</a> |
      <a class="nav-item" title="Handpicked word art" href='../../quotes'>Quotes</a> |
      <a class="nav-item" title="Buckets of my writing" href='../../tags'>Tags</a> |
      <a class="nav-item" href='https://github.com/abhn'>Github</a> |
      <span class="nav-item" id="nav-details-toggle">More ‚ú®</span>
    </summary>

    <form action="../../index.html" method="get" target="_blank">
  <label for="search-input">‚û°Ô∏è Search for a specific term: </label>
  <input id="search-input" name="s" type="text" placeholder="search term" name="" required>
  <input type="submit" value="Search">
</form>

    <p><label for="dark-mode-toggle">‚û°Ô∏è Toggle dark mode üåó</label>&nbsp;
    <input id="dark-mode-toggle" type="checkbox"/></p>

    <p>‚û°Ô∏è Subscribe via a <a href="https://en.wikipedia.org/wiki/Web_feed">feeds</a> reader: 
      <a href="../../index.html?feed=rss2">RSS</a>,
      <a href="../../index.html?feed=atom">Atom</a></p>

  </details>
</nav>
  <div>
    Theme: <a href="https://github.com/abhn/Elementary">Elementary</a>
    <br/>
    <a>Abhishek Nagekar</a> &copy; 2025  </div>
</footer>

<script type="speculationrules">
{"prefetch":[{"source":"document","where":{"and":[{"href_matches":"\/*"},{"not":{"href_matches":["\/wp-*.php","\/wp-admin\/*","\/wp-content\/uploads\/*","\/wp-content\/*","\/wp-content\/plugins\/*","\/wp-content\/themes\/s\/*","\/*\\?(.+)"]}},{"not":{"selector_matches":"a[rel~=\"nofollow\"]"}},{"not":{"selector_matches":".no-prefetch, .no-prefetch a"}}]},"eagerness":"conservative"}]}
</script>

<!-- Koko Analytics v2.0.19 - https://www.kokoanalytics.com/ -->
<script>
!function(){var e=window,r="koko_analytics";function t(t){t.m=e[r].use_cookie?"c":e[r].method[0],navigator.sendBeacon(e[r].url,new URLSearchParams(t))}e[r].request=t,e[r].trackPageview=function(){if("prerender"!=document.visibilityState&&!/bot|crawl|spider|seo|lighthouse|facebookexternalhit|preview/i.test(navigator.userAgent)){var i=0==document.referrer.indexOf(e[r].site_url)?"":document.referrer;t({pa:e[r].path,po:e[r].post_id,r:i})}},e.addEventListener("load",function(){e[r].trackPageview()})}();
</script>

<script src="../../wp-content/themes/s/build/index.js?ver=1.0.0" id="elementary-script-js"></script>

</body>
</html>
