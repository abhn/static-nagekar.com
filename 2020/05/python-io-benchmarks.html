<!doctype html>
<html lang="en-US">

<!-- Mirrored from nagekar.com/2020/05/python-io-benchmarks.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 23 Nov 2025 10:21:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="alternate" type="application/rss+xml" title="Subscribe to Abhishek Nagekar's Blog" href="../../indexd784.html?feed=rss2" />
  <link rel="alternate" type="application/atom+xml" title="Subscribe to Abhishek Nagekar's Blog" href="../../index6e0a.html?feed=atom" />

	<title>Concurrency In Python For Network I/O &#8211; Synchronous, Threading, Multiprocessing and Asynchronous IO &#8211; Abhishek Nagekar</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<script>
window.koko_analytics = {"url":"https:\/\/nagekar.com\/koko-analytics-collect.php","site_url":"https:\/\/nagekar.com","post_id":1026,"path":"\/2020\/05\/python-io-benchmarks.html","method":"none","use_cookie":false};
</script>
<link rel="alternate" type="application/rss+xml" title="Abhishek Nagekar &raquo; Feed" href="../../feed" />
<style id='classic-theme-styles-inline-css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='elementary-style-css' href='../../wp-content/themes/s/style8a54.css?ver=1.0.0' media='all' />
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" title="JSON" type="application/json" href="../../wp-json/wp/v2/posts/1026.json" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc0db0.html?rsd" />

<link rel="canonical" href="python-io-benchmarks.html" />
<link rel='shortlink' href='../../index8285.html?p=1026' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed3d45.json?url=https%3A%2F%2Fnagekar.com%2F2020%2F05%2Fpython-io-benchmarks.html" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed88ab?url=https%3A%2F%2Fnagekar.com%2F2020%2F05%2Fpython-io-benchmarks.html&amp;format=xml" />
<link rel="icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-32x32.png" sizes="32x32" />
<link rel="icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="../../wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-180x180.png" />
<meta name="msapplication-TileImage" content="https://nagekar.com/wp-content/uploads/2020/12/cropped-cropped-cropped-favicon-270x270.png" />
		<style id="wp-custom-css">
			
.quotes-ol-container {
	display: flex;
  flex-direction: column-reverse;
}

.quotes-ol-container li {
	flex: 0 0 auto;
}		</style>
		</head>

<body class="wp-singular post-template-default single single-post postid-1026 single-format-standard wp-theme-s">
<div class="container">
	<nav class="top-nav">
  <details class="nav-details-wrapper">
    <summary>
      <a class="nav-item" href='../../index.html'>Home</a> |
      <a class="nav-item" title="About this blog and me" href='../../about.html'>About</a> |
      <a class="nav-item" title="Handpicked word art" href='../../quotes.html'>Quotes</a> |
      <a class="nav-item" title="Buckets of my writing" href='../../tags.html'>Tags</a> |
      <a class="nav-item" href='https://github.com/abhn'>Github</a> |
      <span class="nav-item" id="nav-details-toggle">More ‚ú®</span>
    </summary>

    <form action="https://nagekar.com/" method="get" target="_blank">
  <label for="search-input">‚û°Ô∏è Search for a specific term: </label>
  <input id="search-input" name="s" type="text" placeholder="search term" name="" required>
  <input type="submit" value="Search">
</form>

    <p><label for="dark-mode-toggle">‚û°Ô∏è Toggle dark mode üåó</label>&nbsp;
    <input id="dark-mode-toggle" type="checkbox"/></p>

    <p>‚û°Ô∏è Subscribe via a <a href="https://en.wikipedia.org/wiki/Web_feed">feeds</a> reader: 
      <a href="../../indexd784.html?feed=rss2">RSS</a>,
      <a href="../../index6e0a.html?feed=atom">Atom</a></p>

  </details>
</nav>
  <hr class="stylish"/>

<div class="_progress-wrapper">
  <div id="_progress"></div>
</div>

<header>
	<h1>Concurrency In Python For Network I/O &#8211; Synchronous, Threading, Multiprocessing and Asynchronous IO</h1>
	<header class="title-tags">
		<time>5 May, 2020. It was a Tuesday</time>
		<div class="tags-container">
			Posted under <span>
										<a class="tags" href="../../tags.html#python">python</a>
							</span>
			&nbsp;
		</div>
	</header>
</header>

<hr class="stylish" />

<main role="main">

	
		<article>
			<section class="content">
				<p>
  In this article, let&#8217;s look at some of the ways to do batch HTTP requests in Python and some of the tools at our disposal. Mainly, we&#8217;ll look at the following ways:
</p>
<ol>
<li>Synchronous with <code>requests</code> module</li>
<li>Parallel with <code>multiprocessing</code> module</li>
<li>Threaded with <code>threading</code> module</li>
<li>Event loop based with <code>asyncio</code> module</li>
</ol>
<p>
  I was inspired to do this because I had a task at hand which required me to write code for a superset of this problem. As someone who can write basic Python, I implemented the most straightforward solution with <code>for</code> loops and <code>requests</code> module. The task was to perform HTTP HEAD requests on a bunch of URLs, around 20,000 of them. The goal was to figure out which of URLs are non-existent (404s, timeouts and so on) in a bunch of markdown files. Averaging a couple of URLs a second on my home network and my personal computer, it would&#8217;ve taken a good 3-5 hours.
</p>
<p>
  I knew there had to be a better way. The search for one lead to me learning a few things and this blog post. So let&#8217;s get started with each solution. Do note that depending on the hardware and network, it might go up and down quite a bit, but what&#8217;s interesting is the relative improvements we make going from one method to the next.
</p>
<h3>Synchronous code with <code>requests</code> module</h3>
<figure class="highlight">
<pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre>
</td>
<td class="code">
<pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">helper.urls</span> <span class="kn">import</span> <span class="n">urls</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="k">def</span> <span class="nf">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f'Synchronous: </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  If you try to think what you&#8217;d do if you had to check 10 URLs if they work, and write that process down in pseudocode form, this approach is pretty much what you&#8217;d get. Single threaded and synchronous, just like a human.
</p>
<p>
  This script fetches 800 random URLs from a different file, makes an HTTP HEAD request to each, and then times the whole operation using <code>time.perf_counter()</code>.
</p>
<p>
  I ran all the tests on a Raspberry Pi 3 running freshly installed Ubuntu 20.04 LTS, but I don&#8217;t intend on making this scientific or reproducible, so don&#8217;t take the results at face value and test it yourself. Better yet, correct me and tell me how I could&#8217;ve done it better!
</p>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/synchronous.png"/><figcaption>Synchronous code took 536 seconds to hit 800 URLs</figcaption></figure>
<p>
  With that we have our baseline. 536 seconds for 800  URLs that we can use to compare our other methods against.
</p>
<h3>Multiprocessing with <code>multiprocessing</code> module</h3>
<figure class="highlight">
<pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre>
</td>
<td class="code">
<pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">helper.urls</span> <span class="kn">import</span> <span class="n">urls</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">cpu_count</span>


<span class="k">def</span> <span class="nf">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">())</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">p</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">make_request</span><span class="p">,</span> <span class="n">urls</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f'Multiprocessing: </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  My Raspberry Pi is a quad core board, so it can have 4 processes running in parallel. Python conveniently provides us with a <code>multiprocessing</code> module that can help us do exactly that. Theoretically, we should see everything done in about 25% of the time (4x the processing power).
</p>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/multiprocessing.png"/><figcaption>Multiprocessing solution took 121 seconds</figcaption></figure>
<p>
  So a bit less than 25% but if I run both the scripts over and over again, the average converges to a ratio of roughly 4:1 as we&#8217;d expect.
</p>
<h3>Threading with <code>threading</code> module</h3>
<figure class="highlight">
<pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre>
</td>
<td class="code">
<pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">helper.urls</span> <span class="kn">import</span> <span class="n">urls</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">threading</span>


<span class="k">def</span> <span class="nf">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">make_request</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">url</span><span class="p">,))</span>
        <span class="n">threads</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
        <span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">driver</span><span class="p">()</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f'Threading: </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  With threading, we essentially use just one process but offload the work to a number of thread that run concurrently (along with each other but not technically parallel).
</p>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/threading.png"/><figcaption>Threading code runs in 41 seconds</figcaption></figure>
<p>
  Threading runs much faster than the multiprocessing, but that&#8217;s expected as threading is the right tool for network and I/O bound workload while multiprocessing suits CPU intensive workloads better.
</p>
<h3>Short detour: visualizing threading and multiprocessing</h3>
<p>
  If you look into your system monitor, or use <a href="https://hisham.hm/htop/">htop</a> like I have in the following images, you&#8217;ll see how multiprocessing differs from threading. On my dual core (with 4 threads) <a href="../04/thinkpad-x230-in-2020.html">personal computer</a>, <strong>multiprocessing creates four processes (with only the default one thread per process)</strong>, while <strong>threading solution creates a much larger number of threads all spawned from one process</strong>.
</p>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/multiprocessing-htop.png"/><br />
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/threading-htop.png"/><figcaption>Code running the multiprocessing [above] and threading [below] solution as viewed through htop</figcaption></figure>
<p>
  This helped me better understand the difference between threads and processes on a high level and why threading solution is much faster for this particular workload.
</p>
<h3>Asynchronous code with <code>asyncio</code> module</h3>
<figure class="highlight">
<pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre>
</td>
<td class="code">
<pre><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">helper.urls</span> <span class="kn">import</span> <span class="n">urls</span>
<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">asyncio</span>

<span class="n">async_client</span> <span class="o">=</span> <span class="n">httpx</span><span class="p">.</span><span class="n">AsyncClient</span><span class="p">()</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">await</span> <span class="n">async_client</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">__class__</span><span class="p">.</span><span class="n">__name__</span><span class="p">)</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">driver</span><span class="p">():</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">make_request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">asyncio</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">driver</span><span class="p">())</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f'Async IO: </span><span class="si">{</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">'</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre>
</td>
</tr>
</tbody>
</table>
<p></code></figure>
<p>
  Finally, we reach Async IO, sort of the right tool for the job given its event driven nature. It was also what sparked my curiosity in the subject in the first place as it is quite fascinating, coming from the event driven JavaScript land, to find an event loop in Python. [Read: <a href="../../2016/02/callbacks-eventloop-in-javascript-explained.html">Callbacks And Event Loop Explained</a> and <a href="../../2016/04/event-driven-programming.html">Event Driven Programming</a>]
</p>
<figure>
  <img decoding="async" src="https://www.nagekar.com/wp-content/uploads/2020/12/asyncio.png" /><figcaption>Asynchronous IO code ran in 11 seconds</figcaption></figure>
<p>
  Clearly this task is made for this approach, and the code looks surprisingly simple to understand which is a plus.
</p>
<h3>In closing</h3>
<p>
  That&#8217;s it for this little adventure in Python land   I sincerely hope you enjoyed it. If you find any corrections and improvements in the above text, please write them to me. It will help me get better at Python (and writing  )
</p>
<p>
  Thank you for reading</p>
			</section>

			<hr class="stylish"/>

			<aside class="featured-posts">
  <h3>Unrelated</h3>
  <ul>
    <li><a href="../../2021/02/the-best-time-of-your-life-is-right-now.html">The Best Time Of Your Life Is Right Now</a></li>
    <li><a href="../../2019/01/mumbai-to-berlin.html">Mumbai To Berlin</a></li>
    <li><a href="../../2018/03/hum-devs-kab-banenge.html">Hum Developers Kab Banenge?</a></li>
    <li><a href="../../2016/11/a-visit-to-the-taj-mahal.html">A Visit To The Taj Mahal</a></li>
    <li><a href="../../2019/05/be-easy-on-yourself.html">Be Easy On Yourself</a></li>
  </ul>
</aside>

			<hr class="stylish"/>

			<section class="pagination">
				
					<a class="prev" href="../04/thinkpad-x230-in-2020.html">&laquo; Buying A Lenovo Thinkpad X230 In 2020</a>

					
					<a class="next" href="chess.html"> Chess &#8211; Basics &raquo;</a>

								</section>

		</article>

	
</main><!-- #main -->


</div>

<footer>
  <hr class="stylish"/>
  <nav class="top-nav">
  <details class="nav-details-wrapper">
    <summary>
      <a class="nav-item" href='../../index.html'>Home</a> |
      <a class="nav-item" title="About this blog and me" href='../../about.html'>About</a> |
      <a class="nav-item" title="Handpicked word art" href='../../quotes.html'>Quotes</a> |
      <a class="nav-item" title="Buckets of my writing" href='../../tags.html'>Tags</a> |
      <a class="nav-item" href='https://github.com/abhn'>Github</a> |
      <span class="nav-item" id="nav-details-toggle">More ‚ú®</span>
    </summary>

    <form action="https://nagekar.com/" method="get" target="_blank">
  <label for="search-input">‚û°Ô∏è Search for a specific term: </label>
  <input id="search-input" name="s" type="text" placeholder="search term" name="" required>
  <input type="submit" value="Search">
</form>

    <p><label for="dark-mode-toggle">‚û°Ô∏è Toggle dark mode üåó</label>&nbsp;
    <input id="dark-mode-toggle" type="checkbox"/></p>

    <p>‚û°Ô∏è Subscribe via a <a href="https://en.wikipedia.org/wiki/Web_feed">feeds</a> reader: 
      <a href="../../indexd784.html?feed=rss2">RSS</a>,
      <a href="../../index6e0a.html?feed=atom">Atom</a></p>

  </details>
</nav>
  <div>
    Theme: <a href="https://github.com/abhn/Elementary">Elementary</a>
    <br/>
    <a>Abhishek Nagekar</a> &copy; 2025  </div>
</footer>

<script type="speculationrules">
{"prefetch":[{"source":"document","where":{"and":[{"href_matches":"\/*"},{"not":{"href_matches":["\/wp-*.php","\/wp-admin\/*","\/wp-content\/uploads\/*","\/wp-content\/*","\/wp-content\/plugins\/*","\/wp-content\/themes\/s\/*","\/*\\?(.+)"]}},{"not":{"selector_matches":"a[rel~=\"nofollow\"]"}},{"not":{"selector_matches":".no-prefetch, .no-prefetch a"}}]},"eagerness":"conservative"}]}
</script>

<!-- Koko Analytics v2.0.19 - https://www.kokoanalytics.com/ -->
<script>
!function(){var e=window,r="koko_analytics";function t(t){t.m=e[r].use_cookie?"c":e[r].method[0],navigator.sendBeacon(e[r].url,new URLSearchParams(t))}e[r].request=t,e[r].trackPageview=function(){if("prerender"!=document.visibilityState&&!/bot|crawl|spider|seo|lighthouse|facebookexternalhit|preview/i.test(navigator.userAgent)){var i=0==document.referrer.indexOf(e[r].site_url)?"":document.referrer;t({pa:e[r].path,po:e[r].post_id,r:i})}},e.addEventListener("load",function(){e[r].trackPageview()})}();
</script>

<script src="../../wp-content/themes/s/build/index8a54.js?ver=1.0.0" id="elementary-script-js"></script>

<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"dd6930e6eb8c44088fd6b2cf3e5a2dea","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>

<!-- Mirrored from nagekar.com/2020/05/python-io-benchmarks.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 23 Nov 2025 10:22:01 GMT -->
</html>
