{"id":1294,"date":"2021-04-01T09:00:32","date_gmt":"2021-04-01T07:00:32","guid":{"rendered":"https:\/\/www.nagekar.com\/?p=1294"},"modified":"2021-07-11T17:02:43","modified_gmt":"2021-07-11T15:02:43","slug":"guide-to-a-sane-wordpress-workflow","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2021\/04\/guide-to-a-sane-wordpress-workflow.html","title":{"rendered":"Guide To A Sane WordPress Workflow"},"content":{"rendered":"<p>Like most things in life, WordPress isn&#8217;t perfect. But for a publishing platform, it is quite up there with the best in the business. For writing, I haven&#8217;t had any complaints so far, but when it came to customization or workflows around maintaining a theme, I was a little lost.<\/p>\n<p>To me it somehow felt very liberating and restricting at the same time. Liberating, because of the ecosystem; themes, plugins, hosting platforms, tons of helpful resources and support. Restricting, if and when you want to build a custom theme and don&#8217;t speak much PHP, general added complexity compared to a static site generator, having to deal with hosting providers, updates and added maintenance work.<\/p>\n<p>But depending on the requirements, WordPress might actually make a lot of sense as a publishing platform (well, of course. <a href=\"https:\/\/wordpress.org\/about\/features\/\">It powers 40% of the web<\/a>). My blog used to be hosted on Github Pages with Jekyll as the site generator until I made the <a href=\"https:\/\/www.nagekar.com\/2021\/01\/life-goes-full-circle-blog-back-to-wordpress.html\">switch to WordPress<\/a> a couple of months ago. What I did struggle with was finding a setup that offered a smooth workflow around managing a custom theme with self hosted WordPress instance.<\/p>\n<p>This article is an attempt at fixing that and aggregating some useful tips. I&#8217;ll try to cover the following:<\/p>\n<ul>\n<li>A <strong>self hosted WordPress<\/strong> website that&#8217;s affordable yet stable<\/li>\n<li><strong>Continuous deployment pipeline<\/strong> for custom themes<\/li>\n<li><strong>Backups<\/strong> that are reliable<\/li>\n<li><strong>CDN<\/strong> and <strong>caching<\/strong><\/li>\n<li><strong>Securing the website<\/strong><\/li>\n<\/ul>\n<p>Let&#8217;s get started.<\/p>\n<h2>Platform setup<\/h2>\n<p>I decided to go with <a href=\"https:\/\/aws.amazon.com\/lightsail\/projects\/wordpress\/\">AWS Lightsail one click WordPress install<\/a>. You&#8217;ll find more information on the <a href=\"https:\/\/bitnami.com\/stack\/wordpress\">Bitnami WordPress<\/a> page about the stack. It is lightweight and runs perfectly fine on a 512MB RAM \/ 1vCPU instance. Once behind a CDN and page cache, the website can handle a fair number of visitors.<\/p>\n<h2>Continuous Deployment (CD) pipeline (optional: Continuous Integration)<\/h2>\n<p>This step assumes you have a <a href=\"https:\/\/github.com\/abhn\/Elementary-Wordpress\">custom WordPress theme<\/a> or source code of a theme available on a GitHub repository. You only need to follow this step if you think you&#8217;ll be making frequent changes to your theme files and would like to have a pipeline for the automatic deploy of the theme (say, for example, when you commit a change to the master branch of your repository). Alternatively, you can always create a zip file of the theme and upload it manually via the WordPress admin panel if you prefer to keep things simple.<\/p>\n<p>Assuming you have a theme hosted on GitHub, you&#8217;ll need to make use of Travis CI to build your code (if there&#8217;s any CSS or JS that needs to be transpiled), test it (if there are any checks) and then upload the files to the AWS LightSail instance using secure copy (scp). Following are some resources to help you get started.<\/p>\n<ul>\n<li>Underscore &#8211; Minimal WordPress starter template: <a href=\"https:\/\/underscores.me\/\">https:\/\/underscores.me\/<\/a><\/li>\n<li>Tutorial for deploying from Travis using SSH and SCP: <a href=\"https:\/\/oncletom.io\/2016\/travis-ssh-deploy\/\">https:\/\/oncletom.io\/2016\/travis-ssh-deploy\/<\/a><\/li>\n<li>Elementary WordPress template <a href=\"https:\/\/github.com\/abhn\/Elementary-Wordpress\/blob\/master\/.travis.yml\">Travis file<\/a>, <a href=\"https:\/\/github.com\/abhn\/Elementary-Wordpress\/blob\/master\/package.json\">package.json<\/a> and <a href=\"https:\/\/github.com\/abhn\/Elementary-Wordpress\/blob\/master\/scripts\/deploy.sh\">deploy script<\/a> for reference.<\/li>\n<\/ul>\n<h2>Backups<\/h2>\n<p>For backups, I&#8217;m using a couple of strategies but I think either one should suffice for my usecase.<\/p>\n<h3>AWS Lightsail snapshots<\/h3>\n<p>I&#8217;d recommend enabling automatic daily snapshots of your instance in AWS Lightsail. So if things go very south, you will lose 1 day&#8217;s worth of data at most. Since my blog&#8217;s content is rarely updated, this means this works near perfectly.<\/p>\n<h3><a href=\"https:\/\/wpvivid.com\/\"><span style=\"text-decoration: underline;\">WPVivid WordPress plugin<\/span><\/a><\/h3>\n<p>WPVivid is a nice plugin that offers more precise backups, meaning you can choose to backup just your database, or files, or both. It also has cron functionality and offer 12 hourly backups (more frequent if you&#8217;re a paying customer). WPVivid allows you to transfer the backups to Google Drive, AWS S3, Dropbox among many other third party providers.<\/p>\n<h2>Server health monitoring and alerts<\/h2>\n<p>I&#8217;m using New Relic to monitor the health of the WordPress instance. It isn&#8217;t necessary as AWS Lighsail already comes with basic dashboards for monitoring CPU performance and burst usage (giving a rough idea about whether the server is sweating under load), but if you&#8217;d like to go a bit fancy with the whole monitoring thing and set up alerts for throughput, error rate etc, New Relic is quite good.<\/p>\n<p>New Relic really shines at showing you the external services your instance is talking to, database operations and the CPU usage share per plugin that you have installed on your WordPress website. That information can help you debug any services \/ plugins that are slowing down your website or doing something strange behind your back.<\/p>\n<figure id=\"attachment_1299\" aria-describedby=\"caption-attachment-1299\" style=\"width: 640px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-1299 size-large\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-44-809x1024.png\" alt=\"AWS metrics\" width=\"640\" height=\"810\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-44-809x1024.png 809w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-44-237x300.png 237w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-44-768x972.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-44.png 820w\" sizes=\"auto, (max-width: 640px) 100vw, 640px\" \/><figcaption id=\"caption-attachment-1299\" class=\"wp-caption-text\">Metrics in AWS Lightsail<\/figcaption><\/figure>\n<figure id=\"attachment_1300\" aria-describedby=\"caption-attachment-1300\" style=\"width: 751px\" class=\"wp-caption alignnone\"><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-1300\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50-1024x578.png\" alt=\"Metrics in New Relic\" width=\"751\" height=\"424\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50-1024x578.png 1024w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50-300x169.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50-768x434.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50-1536x867.png 1536w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-50.png 1861w\" sizes=\"auto, (max-width: 751px) 100vw, 751px\" \/><figcaption id=\"caption-attachment-1300\" class=\"wp-caption-text\">Metrics in New Relic<\/figcaption><\/figure>\n<p>Both AWS Lightsail alerts and New Relic alerts support multiple channels, so feel free to use SMS, email, Slack or whatever your preferred way of getting alerted is.<\/p>\n<h2>CDN and Caching<\/h2>\n<p>My go-to CDN for any personal website is Cloudflare and that is what I&#8217;m using here. I didn&#8217;t have any problems with the admin interface behind the CDN and all seems to work very well. I have a page rule that overwrites cache control headers from WordPress and forces everything under <em>\/wp-content\/*<\/em> to be cached.<\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-1313\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_23-50-300x124.png\" alt=\"\" width=\"500\" height=\"207\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_23-50-300x124.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_23-50-768x318.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_23-50.png 955w\" sizes=\"auto, (max-width: 500px) 100vw, 500px\" \/><\/p>\n<p>For page caching, I&#8217;m using a plugin called <a href=\"https:\/\/wordpress.org\/plugins\/w3-total-cache\/\">WP Total Cache<\/a>. It was the most popular performance optimization plugin and was recommended to me. It has a &#8220;Page Cache&#8221; option which needs to be enabled and set to use disk as cache store.<\/p>\n<h2>Security<\/h2>\n<p>To secure the Lightsail instance, I&#8217;m following some basic good practices and a plugin to help me set up some blocking rules.<\/p>\n<ol>\n<li>Lightsail instance is as close to stock as possible making sure there are no random packages installed from my side on the instance.<\/li>\n<li>Disable port 80, and if you&#8217;re using a reverse proxy CDN like Cloudflare, only allow Cloudflare IPs to your origin server.<img loading=\"lazy\" decoding=\"async\" class=\"wp-image-1298 aligncenter\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-36.png\" alt=\"\" width=\"355\" height=\"212\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-36.png 757w, https:\/\/nagekar.com\/wp-content\/uploads\/2021\/03\/2021-03-31_18-36-300x179.png 300w\" sizes=\"auto, (max-width: 355px) 100vw, 355px\" \/><\/li>\n<li>As with Lightsail, WordPress installation should be close to stock with minimal plugins.<\/li>\n<li><a href=\"https:\/\/www.wordfence.com\/\">Wordfence WordPress plugin<\/a> for\n<ol>\n<li>2FA authentication<\/li>\n<li>Banning incorrect login attempts, or login attempts using generic usernames like admin, administrator or root.<\/li>\n<li>reCAPTCHA on the login page (you&#8217;ll need API keys from Google)<\/li>\n<li>Disable xmlrpc if you&#8217;re not planning on using apps. Enable 2FA on it, or disable login via xmlrpc.<\/li>\n<li>Go through all the options that Wordfence has to offer and use whatever makes sense for your use case. I found them to be quite useful and intuitive.<\/li>\n<\/ol>\n<\/li>\n<li>In general, keep stuff up to date.<\/li>\n<\/ol>\n<h2>Conclusion<\/h2>\n<p>That&#8217;s it for this article. If you have any questions or suggestions, please feel free to write to me. Thank you for reading.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Like most things in life, WordPress isn&#8217;t perfect. But for a publishing platform, it is quite up there with the best in the business. For writing, I haven&#8217;t had any complaints so far, but when it came to customization or workflows around maintaining a theme, I was a little lost. To me it somehow felt [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":1300,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[198,197],"class_list":["post-1294","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","category-uncategorized","tag-blogging","tag-wordpress"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1294","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1294"}],"version-history":[{"count":22,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1294\/revisions"}],"predecessor-version":[{"id":1366,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1294\/revisions\/1366"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media\/1300"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1294"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1294"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1294"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}