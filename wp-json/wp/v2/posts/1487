{"id":1487,"date":"2022-03-31T02:02:19","date_gmt":"2022-03-31T00:02:19","guid":{"rendered":"https:\/\/www.nagekar.com\/?p=1487"},"modified":"2022-04-18T22:22:21","modified_gmt":"2022-04-18T20:22:21","slug":"perfect-100-pagespeed-score-wordpress","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2022\/03\/perfect-100-pagespeed-score-wordpress.html","title":{"rendered":"Perfect 100\/100 PageSpeed Score With WordPress"},"content":{"rendered":"\n<p>A long time ago I worked on a theme called <a href=\"https:\/\/github.com\/abhn\/Elementary\">Elementary<\/a> for my Jekyll blog. The goal was simple, to create a website that just works, and works fast. In fact, I&#8217;ll just paste the line from the readme of the GitHub repository.<\/p>\n\n\n\n<blockquote class=\"wp-block-quote is-layout-flow wp-block-quote-is-layout-flow\"><p dir=\"auto\">This is my personal blog&#8217;s Jekyll template that I&#8217;ve been optimizing for performance, accessibility, usability, readability and simplicity in general.<\/p><p dir=\"auto\">I personally do not approve of personal blogs bloated with hundreds of kilobytes of trackers and analytics code, and hence, this is an attempt at creating something that I&#8217;d be comfortable with using on my website.<\/p><\/blockquote>\n\n\n\n<p>The goal was accomplished. I managed to get a perfect score on many of the pages. But I wanted to write more and while on the go, and plaintext editing on phones is a pain. Then the other problem was to add it to git and push it. In short, working with a static blog from an Android phone wasn&#8217;t easy.<\/p>\n\n\n\n<p>That&#8217;s when I moved to WordPress. I ported the theme to <a href=\"https:\/\/github.com\/abhn\/Elementary-Wordpress\">Elementary-WordPress<\/a>, which is essentially the same theme but in a WordPress shell. It worked really well, but the problem was all the bloat that WordPress sends to the frontend. For a while I didn&#8217;t care enough. I was still serving a fast website, albeit with Jquery, emojis and other code that wasn&#8217;t getting used anywhere else.<\/p>\n\n\n\n<p>Today, that changed. I finally took some time to optimize the website and got back my perfect 100\/100 PageSpeed score. Here&#8217;s how I did it.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\">Table of contents<\/h2>\n\n\n\n<ol class=\"wp-block-list\"><li><a href=\"#jquery\">Disable jQuery<\/a><\/li><li><a href=\"#wp-embed\">Disable wp-embed<\/a><\/li><li><a href=\"#block-library-css\">Disable block library CSS<\/a><\/li><li><a href=\"#emoji\">Disable emoji<\/a><\/li><li><a href=\"#fonts\">Serve fonts from same domain<\/a><\/li><li><a href=\"#font-display\">Use font-display: optional property<\/a><\/li><li><a href=\"#memcached\">Use an in-memory page cache like Memcached<\/a><\/li><li><a href=\"#conflicting-cache\">Fix conflicting cache strategies<\/a><\/li><li><a href=\"#cdn\">Use a CDN for asset delivery<\/a><\/li><li><a href=\"#inline-css-js\">TODO: Inline all CSS and Javascript<\/a><\/li><\/ol>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"jquery\">Disable jQuery<\/h2>\n\n\n\n<p>If your website isn&#8217;t ancient, there&#8217;s a good chance you&#8217;re not using it. If some plugin you&#8217;re using is using jQuery, consider alternatives. It will save you ~30KB and an HTTP request. Adding the following to the <code>functions.php<\/code> should do it.<\/p>\n\n\n\n<pre class=\"wp-block-preformatted\">function jquery_dequeue() { <br>&nbsp;&nbsp;wp_deregister_script( 'jquery' ); <br>} <br>add_action( 'wp_enqueue_scripts', 'jquery_dequeue' );<\/pre>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"wp-embed\">Disable wp-embed<\/h2>\n\n\n\n<p>The following snippet <a href=\"https:\/\/wordpress.stackexchange.com\/questions\/211701\/what-does-wp-embed-min-js-do-in-wordpress-4-4\">from this answer<\/a> needs to be added to <code>functions.php<\/code><\/p>\n\n\n\n<pre class=\"wp-block-preformatted\">function wp_embed_dequeue() {<br>&nbsp; wp_deregister_script( 'wp-embed' );<br>}<br>add_action( 'wp_footer', 'wp_embed_dequeue' );<\/pre>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"block-library-css\">Disable block library CSS<\/h2>\n\n\n\n<p>*Sigh* This goes into the <code>functions.php<\/code><\/p>\n\n\n\n<pre class=\"wp-block-preformatted\">function remove_wp_block_library_css(){<br>&nbsp; wp_dequeue_style( 'wp-block-library' );<br>}<br>add_action( 'wp_enqueue_scripts', 'remove_wp_block_library_css' );<\/pre>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"emoji\">Disable emoji<\/h2>\n\n\n\n<p>I found some nice code to disable a whole bunch of unnecessary actions from this guide here: <a href=\"https:\/\/kinsta.com\/knowledgebase\/disable-emojis-wordpress\/#2-disable-emojis-in-wordpress-with-code\">https:\/\/kinsta.com\/knowledgebase\/disable-emojis-wordpress\/#2-disable-emojis-in-wordpress-with-code<\/a><\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"fonts\">Serve fonts from same domain<\/h2>\n\n\n\n<p>If you&#8217;re not super keen on using the smart browser detection functionality that Google Fonts offers and are happy only supporting modern browsers, simply downloading the font files and linking them with <code>@font-face<\/code> can save an additional DNS and HTTP request.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"font-display\">Use font-display: optional property<\/h2>\n\n\n\n<p>I&#8217;m using <code>font-display: optional;<\/code> CSS property on my @font-face and it pushed my PageSpeed score over the top. Essentially it prevents the CLS, or <a href=\"https:\/\/web.dev\/cls\/\">Cumulative Layout Shift<\/a> metric of Core Web Vitals from getting affected due to page shifting due to slow loading of font files.<\/p>\n\n\n\n<p>Read more about it here: <a href=\"https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/CSS\/@font-face\/font-display\">https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/CSS\/@font-face\/font-display<\/a><\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"memcached\">Use an in-memory page cache like Memcached<\/h2>\n\n\n\n<p>Building pages to serve the users is expensive as it involves the database, but isn&#8217;t something that needs to be done for every visitor visiting the same page. A plugin like W3 Total Cache coupled with a Memcached instance (could be running on the same server as the website) could enable caching of pages among other resources in memory, reducing the load on the server and improving performance for cache-hit pages.<\/p>\n\n\n\n<figure class=\"wp-block-image\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"378\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2022\/03\/2022-03-31_11-34-1024x378.png\" alt=\"memcached\" class=\"wp-image-1503\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/2022-03-31_11-34-1024x378.png 1024w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/2022-03-31_11-34-300x111.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/2022-03-31_11-34-768x284.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/2022-03-31_11-34.png 1070w\" sizes=\"auto, (max-width: 1024px) 100vw, 1024px\" \/><\/figure>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"conflicting-cache\">Fix conflicting cache strategies<\/h2>\n\n\n\n<p>I&#8217;m using W3 Total Cache plugin that helps minify and cache CSS and JS files. But I wasn&#8217;t seeing any minification happening. Upon some reading, it turns out that CloudFlare&#8217;s minification conflicts with W3 Total Cache&#8217;s. Disabling it on CloudFlare&#8217;s side fixed the non-minification problem for me.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"cdn\">Use a CDN for asset delivery<\/h2>\n\n\n\n<p>Once the thing to deliver is optimized, it is a good idea to optimize the delivery pipeline as well. Since my server is in the same country as me, it is easy to make a mistake of thinking every visitor of the website is seeing a 50 milliseconds time to connect to the server. The further the user is from the origin server, the longer it could take.<\/p>\n\n\n\n<p>Hence, an global CDN like CloudFlare should be used which can serve static content from its edge node physically closest to the visitor.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\" id=\"inline-css-js\">TODO: Inline all CSS and Javascript<\/h2>\n\n\n\n<p>It doesn&#8217;t go beyond 100, but I&#8217;d still like to improve it further. For one, the little bit of CSS and JS that does exist doesn&#8217;t have to need two additional HTTP requests. Inlining that bit will mean that blog posts without an image, which for me are most of them, will get served in only three HTTP requests; the document, the font file and the favicon. Pretty cool, huh?<\/p>\n\n\n\n<h2 class=\"wp-block-heading\">Conclusion<\/h2>\n\n\n\n<p>I&#8217;m pretty pumped about the 100\/100 score. WordPress has a reputation for being slow and bloated, but with some simple optimizations, it starts performing like how you&#8217;d expect some text on a page to perform like.<\/p>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"897\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2022\/03\/ba8ec3f5-713a-45c6-b3bc-72c8bcf68b6d-1024x897.jpg\" alt=\"\" class=\"wp-image-1491\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/ba8ec3f5-713a-45c6-b3bc-72c8bcf68b6d-1024x897.jpg 1024w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/ba8ec3f5-713a-45c6-b3bc-72c8bcf68b6d-300x263.jpg 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/ba8ec3f5-713a-45c6-b3bc-72c8bcf68b6d-768x672.jpg 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/ba8ec3f5-713a-45c6-b3bc-72c8bcf68b6d.jpg 1206w\" sizes=\"auto, (max-width: 1024px) 100vw, 1024px\" \/><\/figure><\/div>\n\n\n\n<div class=\"wp-block-image\"><figure class=\"aligncenter\"><img loading=\"lazy\" decoding=\"async\" width=\"1024\" height=\"862\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2022\/03\/bfd494f4-9302-4993-8d24-945e76a7e6f3-1024x862.jpg\" alt=\"\" class=\"wp-image-1492\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/bfd494f4-9302-4993-8d24-945e76a7e6f3-1024x862.jpg 1024w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/bfd494f4-9302-4993-8d24-945e76a7e6f3-300x253.jpg 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/bfd494f4-9302-4993-8d24-945e76a7e6f3-768x647.jpg 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2022\/03\/bfd494f4-9302-4993-8d24-945e76a7e6f3.jpg 1208w\" sizes=\"auto, (max-width: 1024px) 100vw, 1024px\" \/><\/figure><\/div>\n\n\n\n<p>Thank you for reading!<\/p>\n\n\n\n<p><\/p>\n","protected":false},"excerpt":{"rendered":"<p>A long time ago I worked on a theme called Elementary for my Jekyll blog. The goal was simple, to create a website that just works, and works fast. In fact, I&#8217;ll just paste the line from the readme of the GitHub repository. This is my personal blog&#8217;s Jekyll template that I&#8217;ve been optimizing for [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[198,29],"class_list":["post-1487","post","type-post","status-publish","format-standard","hentry","category-uncategorized","tag-blogging","tag-web"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1487","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1487"}],"version-history":[{"count":12,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1487\/revisions"}],"predecessor-version":[{"id":1534,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1487\/revisions\/1534"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1487"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1487"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1487"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}