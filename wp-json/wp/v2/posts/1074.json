{"id":1074,"date":"2018-07-05T22:00:00","date_gmt":"2018-07-05T22:00:00","guid":{"rendered":"http:\/\/wp.nagekar.com\/2018\/07\/05\/eli5-deterministic-encryption\/"},"modified":"2018-07-05T22:00:00","modified_gmt":"2018-07-05T22:00:00","slug":"eli5-deterministic-encryption","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2018\/07\/eli5-deterministic-encryption.html","title":{"rendered":"ELI5 &#8211; Deterministic Encryption"},"content":{"rendered":"<p>\n\tSuppose you have a database full of confidential information such as emails of users. As a responsible sysadmin, you&#8217;d not let such data exist in plaintext in your systems and therefore you decide to encrypt everything. But now, the application needs a searching functionality where users can see their emails in the system.\n<\/p>\n<p>\n\tEssentially, you need to run a <b>where email = &#8216; &#8216;<\/b> query on the encrypted database, get all the rows that match, decrypt them and send the decrypted data to the application layer. With traditional encryption modes like CBC or modern <a href=\"\/2018\/07\/eli5-authenticated-encryption.html\">authenticated encryption<\/a> modes like GCM, this would be impossible (or extremely inefficient). This is where deterministic encryption comes into the picture.\n<\/p>\n<h3>Deterministic Encryption<\/h3>\n<p>\n\tDeterministic encryption is nothing fancy. Instead of using modes like CBC and CTR where each block of the ciphertext is dependent on the previous block or the message counter, in deterministic encryption, data can be imagined to be encrypted in EBC mode or the IV kept constant. No nonce is involved. Basically, <b>a plaintext message M will always map to the same ciphertext C in a given deterministic encryption scheme under a particular key K<\/b>.\n<\/p>\n<p>\n\tOnce the data is encrypted into ciphertext, it is sorted and stored. Now, when a search term comes up, it is encrypted using the same key, then the database is queried for this ciphertext which returns all the rows that match. The application can then decrypt these rows with the given key. The search takes logarithmic time (since for the database, this is a normal text search) and the database never sees any data in plaintext.\n<\/p>\n<p>\n\tEven with all of this, deterministic encryption faces all the issues that plague encryption modes like EBC. Namely, if two plaintexts are same, their encrypted ciphertexts would be equivalent as well, thus leaking information to an adversary. Formally, we say that deterministic encryption can never be secure under <a href=\"https:\/\/en.wikipedia.org\/wiki\/Ciphertext_indistinguishability#Indistinguishability_under_chosen-plaintext_attack_(IND-CPA)\">chosen ciphertext attack<\/a>. Although that doesn&#8217;t diminish its value when we have to deal with searchable encrypted datasets.\n<\/p>\n<p><img decoding=\"async\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2020\/12\/enc-mode-ebc.png\"\/><br \/>\n<small><i>From Wikipedia&#8217;s encryption modes of block cipher page<\/i><\/small><\/p>\n<p>\n\tThis means that deterministic encryption cannot (or rather should not) be used when the message space M is small. It can only be used on unique values such as email address or usernames which are designed to be unique in a database.\n<\/p>\n<p>\n  Further reading: <br \/><a href=\"https:\/\/crypto.stackexchange.com\/questions\/6755\/security-of-deterministic-encryption-scheme\">https:\/\/crypto.stackexchange.com\/questions\/6755\/security-of-deterministic-encryption-scheme<\/a><br \/><a href=\"https:\/\/en.wikipedia.org\/wiki\/Deterministic_encryption\">https:\/\/en.wikipedia.org\/wiki\/Deterministic_encryption<\/a>\n<\/p>\n<p>\n\tThank you for reading.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Suppose you have a database full of confidential information such as emails of users. As a responsible sysadmin, you&#8217;d not let such data exist in plaintext in your systems and therefore you decide to encrypt everything. But now, the application needs a searching functionality where users can see their emails in the system. Essentially, you [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":490,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[],"tags":[7,6],"class_list":["post-1074","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","tag-cryptography","tag-eli5"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1074","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1074"}],"version-history":[{"count":0,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1074\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media\/490"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1074"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1074"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1074"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}