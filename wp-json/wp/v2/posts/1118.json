{"id":1118,"date":"2016-05-02T22:00:00","date_gmt":"2016-05-02T22:00:00","guid":{"rendered":"http:\/\/wp.nagekar.com\/2016\/05\/02\/_generic-in-c\/"},"modified":"2016-05-02T22:00:00","modified_gmt":"2016-05-02T22:00:00","slug":"_generic-in-c","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2016\/05\/_generic-in-c.html","title":{"rendered":"_Generic in C And Generic LinkedList Implementation"},"content":{"rendered":"<p>\n  Tada! Finally a non-Javascript post for those of you who stopped visiting my blog because of my sick Js addiction. So my lost friend Aditya is back, and while talking to him, I got to read a piece of code that he wrote when we were in third semester, last year. The aim was to build a generic container to store different datatypes, in C. So yes, literally storing [21, &#8220;abhishek&#8221;, 3.142, &#8216;z&#8217;] in a single dynamically allocated linkedlist. That was pretty bold for us then.\n<\/p>\n<p>\n  For making that happen, he made use of the <a href=\"https:\/\/en.wikipedia.org\/wiki\/C11_(C_standard_revision)#Changes_from_C99_\">_Generic<\/a> macro that C11 introducted for generic type selection. For those unfamiliar with it, I&#8217;ll begin with explaining the basics of the macro. For those of you interested in the linkedlist code, scroll down to the bottom of this article. You can always check out the <a href=\"https:\/\/www.open-std.org\/jtc1\/sc22\/wg14\/www\/docs\/n1570.pdf\">C11 draft [section 6.5.1.1 Generic selection pg #96]<\/a> (the standard costs around $60 but is essentially the same thing).\n<\/p>\n<p>\n\t The _Generic macro follows the format <code>_Generic(controlling-expression, association-list)<\/code> where <i>controlling-expression<\/i> is the expression whose type is to be detected, and <i>association-list<\/i> is the dictionary of type-expression pairs where type can be any object type and the expression can be any expression, constant or a pointer to any function, pretty much anything that can be evaluated.\n<\/p>\n<p>\n\tTo put it simply, compare it to the switch statement for type detection. For example,\n<\/p>\n<figure class=\"highlight\">\n<pre><code class=\"language-c\" data-lang=\"c\"><span class=\"cp\">#include &lt;stdio.h&gt;\n<\/span><span class=\"kt\">int<\/span> <span class=\"nf\">main<\/span><span class=\"p\">()<\/span> <span class=\"p\">{<\/span>\n  <span class=\"kt\">char<\/span> <span class=\"o\">*<\/span><span class=\"n\">teststring<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"my char array\"<\/span><span class=\"p\"&gt;;<\/span> <span class=\"c1\">\/\/ target object<\/span>\n  <span class=\"kt\">char<\/span> <span class=\"o\">*<\/span><span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"k\">_Generic<\/span><span class=\"p\">(<\/span>\n    <span class=\"n\">teststring<\/span><span class=\"p\">,<\/span>\n    <span class=\"nl\">int:<\/span> <span class=\"s\">\"int\"<\/span><span class=\"p\">,<\/span>\n    <span class=\"kt\">int<\/span><span class=\"o\">*:<\/span> <span class=\"s\">\"int *\"<\/span><span class=\"p\">,<\/span>\n    <span class=\"nl\">char:<\/span> <span class=\"s\">\"char\"<\/span><span class=\"p\">,<\/span>\n    <span class=\"kt\">char<\/span><span class=\"o\">*:<\/span> <span class=\"s\">\"char *\"<\/span><span class=\"p\">,<\/span>\n    <span class=\"nl\">float:<\/span> <span class=\"s\">\"float\"<\/span><span class=\"p\">,<\/span>\n    <span class=\"nl\">default:<\/span> <span class=\"s\">\"default\"<\/span>\n  <span class=\"p\"&gt;);<\/span>\n  <span class=\"n\">printf<\/span><span class=\"p\">(<\/span><span class=\"s\">\"%s\"<\/span><span class=\"p\">,<\/span> <span class=\"n\">type<\/span><span class=\"p\"&gt;);<\/span>\n  <span class=\"k\">return<\/span> <span class=\"mi\">0<\/span><span class=\"p\"&gt;;<\/span>\n<span class=\"p\">}<\/span><\/code><\/pre>\n<\/figure>\n<p><\/p>\n<figure class=\"highlight\">\n<pre><code class=\"language-bash\" data-lang=\"bash\"><span class=\"nv\">$ <\/span>gcc main.c\n<span class=\"nv\">$ <\/span>.\/a.out\nchar <span class=\"k\">*<\/span><\/code><\/pre>\n<\/figure>\n<p>\n\tThe _Generic macro can be wrapped around in a nice looking function call, say detect_type(). Compare this to a (pseudo) switch statement which evaluates the case that matches the switch params\n<\/p>\n<figure class=\"highlight\">\n<pre><code class=\"language-c\" data-lang=\"c\"><span class=\"c1\">\/\/ Pseudocode may resemble Javascript. Reader discretion advised<\/span>\n<span class=\"n\">var<\/span> <span class=\"n\">someobj<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"text here\"<\/span><span class=\"p\"&gt;;<\/span> <span class=\"c1\">\/\/ target object<\/span>\n<span class=\"n\">var<\/span> <span class=\"n\">type<\/span><span class=\"p\"&gt;;<\/span> <span class=\"c1\">\/\/ to store the typename<\/span>\n<span class=\"n\">type_switch<\/span><span class=\"p\">(<\/span><span class=\"n\">someobj<\/span><span class=\"p\">)<\/span> <span class=\"p\">{<\/span>\n  <span class=\"k\">case<\/span> <span class=\"kt\">int<\/span><span class=\"p\">:<\/span>\n    <span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"int\"<\/span><span class=\"p\"&gt;;<\/span>\n  <span class=\"k\">case<\/span> <span class=\"kt\">int<\/span><span class=\"o\">*<\/span><span class=\"p\">:<\/span>\n    <span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"int*\"<\/span><span class=\"p\"&gt;;<\/span>\n  <span class=\"k\">case<\/span> <span class=\"kt\">char<\/span><span class=\"p\">:<\/span>\n    <span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"char\"<\/span><span class=\"p\"&gt;;<\/span>\n  <span class=\"k\">case<\/span> <span class=\"kt\">char<\/span><span class=\"o\">*<\/span><span class=\"p\">:<\/span>\n    <span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"char*\"<\/span><span class=\"p\"&gt;;<\/span>\n  <span class=\"nl\">default:<\/span>\n    <span class=\"n\">type<\/span> <span class=\"o\">=<\/span> <span class=\"s\">\"default\"<\/span><span class=\"p\"&gt;;<\/span>\n<span class=\"p\">}<\/span>\n<span class=\"n\">print<\/span><span class=\"p\">(<\/span><span class=\"n\">type<\/span><span class=\"p\">)<\/span><\/code><\/pre>\n<\/figure>\n<p>\n\tSo that is it. A compile time type identification in C with a simple macro. We can do pretty amazing stuff with it using pointers to functions. For example, a generic print function, that can take in any type of argument and print it. I have added cases for integers, characters and string, but others can be added just as easily.\n<\/p>\n<p><script src=\"https:\/\/gist.github.com\/abhn\/3887df927f2d913c03704cac3ddaa9fc.js\"><\/script><\/p>\n<p>\n\tThat was neat, wasn&#8217;t it. Now back to Aditya. He used the same macro to create a dynamically allocated linkedlist. I am pasting the gist here so that you can read his beautiful code.<br \/>\n  <button id=\"btn\">Show Code<\/button>\n<\/p>\n<div id=\"vector\">\n<h4>File <b>linkedlist.c<\/b><\/h4>\n<p>    <script src=\"https:\/\/gist.github.com\/abhn\/0699d92bb972320e33b3cee8f81abc23.js\"><\/script><\/p>\n<h4>File <b>linkedlist.h<\/b><\/h4>\n<p>    <script src=\"https:\/\/gist.github.com\/abhn\/6175447dd928d4c46bdc7f51b90c8b33.js\"><\/script><\/p>\n<h4>File <b>main.c<\/b><\/h4>\n<p>    <script src=\"https:\/\/gist.github.com\/abhn\/cacf3b03483759c02e997afe13aa3373.js\"><\/script>\n  <\/div>\n<\/p>\n<p>\n\tTo compile it, run <code>~$ gcc main.c linkedlist.c -o linkedlist<\/code> on any machine with GCC installed (I&#8217;ve tested it on version &gt;4.9). Run it with <code>~$ .\/linkedlist<\/code> and you should see the different elements that we&#8217;ve added printed on the standard out. You may also pack the linkedlist into a statically linked library, by running.\n<\/p>\n<figure class=\"highlight\">\n<pre><code class=\"language-bash\" data-lang=\"bash\">~<span class=\"nv\">$ <\/span>gcc <span class=\"nt\">-c<\/span> linkedlist.c <span class=\"nt\">-o<\/span> linkedlist.o\n~<span class=\"nv\">$ <\/span>ar rcs linkedlist.a linkedlist.o\n~<span class=\"nv\">$ <\/span>gcc main.c linkedlist.a<\/code><\/pre>\n<\/figure>\n<p>\n  Interesting, isn&#8217;t it? Want to thank him, or have any comments or improvements? Drop them into the comment box. Thank you for reading.\n<\/p>\n<h3>External Links<\/h3>\n<ul>\n<li>\n    <a href=\"https:\/\/www.ibm.com\/support\/knowledgecenter\/SSGH2K_13.1.0\/com.ibm.xlc131.aix.doc\/language_ref\/genericselection.html\">IBM KB article on generic selector<\/a>\n  <\/li>\n<li>\n    <a href=\"https:\/\/www.robertgamble.net\/2012\/01\/c11-generic-selections.html?m=1\">Robert Gamble&#8217;s blog post: c11 generic selections<\/a>\n  <\/li>\n<li>\n    <a href=\"https:\/\/stackoverflow.com\/questions\/9804371\/syntax-and-sample-usage-of-generic-in-c11\">Stackoverflow question: syntax and sample usage of generic in c11<\/a>\n  <\/li>\n<\/ul>\n<p><script>\n  document.getElementById('vector').style.display = 'none';\n  document.getElementById('btn').addEventListener('click', function showVec() {\n    document.getElementById('vector').style.display = 'block';\n  });\n<\/script><\/p>\n","protected":false},"excerpt":{"rendered":"<p>Tada! Finally a non-Javascript post for those of you who stopped visiting my blog because of my sick Js addiction. So my lost friend Aditya is back, and while talking to him, I got to read a piece of code that he wrote when we were in third semester, last year. The aim was to [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[],"tags":[17,16],"class_list":["post-1118","post","type-post","status-publish","format-standard","hentry","tag-c","tag-programming"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1118","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1118"}],"version-history":[{"count":0,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1118\/revisions"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1118"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1118"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1118"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}