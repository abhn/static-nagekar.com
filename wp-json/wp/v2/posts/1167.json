{"id":1167,"date":"2014-12-03T23:00:00","date_gmt":"2014-12-03T23:00:00","guid":{"rendered":"http:\/\/wp.nagekar.com\/2014\/12\/03\/lan-group-messenger-in-python\/"},"modified":"2014-12-03T23:00:00","modified_gmt":"2014-12-03T23:00:00","slug":"lan-group-messenger-in-python","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2014\/12\/lan-group-messenger-in-python.html","title":{"rendered":"Simple group messenger\/chat in Python"},"content":{"rendered":"<p>\n  Aaaaannd here is another post of mine on sockets, client\/server models and stuff. I suppose you have started to get bored by the same stuff everyday right? Seems like I just can&#8217;t get enough of this thing. But trust me, I had no intention of doing this today, a friend of mine instigated me write a messenger for a project we were working on, and it turned out, writing this simple messaging program was more interesting than I thought.\n<\/p>\n<p>\n  So, instead of creating a straight forward chat program that was &#8216;actually&#8217; required by my friend, I created this &#8216;one-server-multiple-clients&#8217; program, which is more like the real world chat apps we use everyday.\n<\/p>\n<p>\n  To run the program, execute the &#8216;server.py&#8217; (after changing the <b>bind() <\/b>address to the address of the server on which it is supposed to run). Then, execute the &#8216;client.py&#8217; (guess what? same thing here. But you will have to add the <i>server address<\/i> in the <b>connect()<\/b> function here). Of course, you can have all of them running on the same system, but there ain&#8217;t any fun in it, right?\n<\/p>\n<p>\n  Last but not the least, I have commented as much as I could, unlike my last article, so I expect everyone reading this, with a bit of programming knowledge, will understand this straight forward code.\n<\/p>\n<h4>server.py<\/h4>\n<figure class=\"highlight\">\n<pre><code class=\"language-python\" data-lang=\"python\"><span class=\"c1\"># Import the necessary libraries\n<\/span><span class=\"kn\">import<\/span> <span class=\"nn\">socket<\/span>\n<span class=\"kn\">import<\/span> <span class=\"nn\">sys<\/span>\n<span class=\"kn\">import<\/span> <span class=\"nn\">select<\/span>\n<span class=\"c1\"># Take message from an host and send it to all others\n<\/span><span class=\"k\">def<\/span> <span class=\"nf\">shout<\/span><span class=\"p\">(<\/span><span class=\"n\">sock<\/span><span class=\"p\">,<\/span> <span class=\"n\">message<\/span><span class=\"p\">):<\/span>\n  <span class=\"k\">for<\/span> <span class=\"n\">socket<\/span> <span class=\"ow\">in<\/span> <span class=\"n\">LIST<\/span><span class=\"p\">:<\/span>\n    <span class=\"k\">try<\/span><span class=\"p\">:<\/span>\n      <span class=\"c1\"># Don't send it back to server and yourself!\n<\/span>      <span class=\"k\">if<\/span> <span class=\"n\">socket<\/span> <span class=\"o\">!=<\/span> <span class=\"n\">serv<\/span> <span class=\"ow\">and<\/span> <span class=\"n\">socket<\/span> <span class=\"o\">!=<\/span> <span class=\"n\">sock<\/span><span class=\"p\">:<\/span>\n        <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">send<\/span><span class=\"p\">(<\/span><span class=\"n\">message<\/span><span class=\"p\">)<\/span>\n    <span class=\"k\">except<\/span><span class=\"p\">:<\/span>\n      <span class=\"c1\"># Assume client has got disconnected and remove it.\n<\/span>      <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">close<\/span>\n      <span class=\"n\">LIST<\/span><span class=\"p\">.<\/span><span class=\"n\">remove<\/span><span class=\"p\">(<\/span><span class=\"n\">socket<\/span><span class=\"p\">)<\/span>\n<span class=\"c1\"># Declare variables required later.\n# To store list of sockets of clients as well as server itself.\n<\/span><span class=\"n\">LIST<\/span> <span class=\"o\">=<\/span> <span class=\"p\">[]<\/span>\n<span class=\"c1\"># Common buffer for all purposes\n<\/span><span class=\"n\">buff<\/span> <span class=\"o\">=<\/span> <span class=\"mi\">1024<\/span>\n<span class=\"c1\"># Declaration of Server socket.\n<\/span><span class=\"n\">serv<\/span> <span class=\"o\">=<\/span> <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">socket<\/span><span class=\"p\">(<\/span><span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">AF_INET<\/span><span class=\"p\">,<\/span> <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">SOCK_STREAM<\/span><span class=\"p\">)<\/span>\n<span class=\"n\">serv<\/span><span class=\"p\">.<\/span><span class=\"n\">setsockopt<\/span><span class=\"p\">(<\/span><span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">SOL_SOCKET<\/span><span class=\"p\">,<\/span> <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">SO_REUSEADDR<\/span><span class=\"p\">,<\/span> <span class=\"mi\">1<\/span><span class=\"p\">)<\/span>\n<span class=\"n\">serv<\/span><span class=\"p\">.<\/span><span class=\"n\">bind<\/span><span class=\"p\">((<\/span><span class=\"s\">\"192.168.1.10\"<\/span><span class=\"p\">,<\/span> <span class=\"mi\">1356<\/span><span class=\"p\">))<\/span>\n<span class=\"c1\"># Listen for upto 6 clients. Increase if you need more.\n<\/span><span class=\"n\">serv<\/span><span class=\"p\">.<\/span><span class=\"n\">listen<\/span><span class=\"p\">(<\/span><span class=\"mi\">6<\/span><span class=\"p\">)<\/span>\n<span class=\"c1\"># Add server socket to the LIST\n<\/span><span class=\"n\">LIST<\/span><span class=\"p\">.<\/span><span class=\"n\">append<\/span><span class=\"p\">(<\/span><span class=\"n\">serv<\/span><span class=\"p\">)<\/span>\n<span class=\"k\">while<\/span> <span class=\"mi\">1<\/span><span class=\"p\">:<\/span>\n  <span class=\"c1\"># Moniter clients all simultaneously\n<\/span>  <span class=\"n\">reads<\/span><span class=\"p\">,<\/span> <span class=\"n\">writes<\/span><span class=\"p\">,<\/span> <span class=\"n\">err<\/span> <span class=\"o\">=<\/span> <span class=\"n\">select<\/span><span class=\"p\">.<\/span><span class=\"n\">select<\/span><span class=\"p\">(<\/span><span class=\"n\">LIST<\/span><span class=\"p\">,<\/span> <span class=\"p\">[],<\/span> <span class=\"p\">[])<\/span>\n  <span class=\"k\">for<\/span> <span class=\"n\">sock<\/span> <span class=\"ow\">in<\/span> <span class=\"n\">reads<\/span><span class=\"p\">:<\/span>\n    <span class=\"c1\"># A new client connected?\n<\/span>    <span class=\"k\">if<\/span> <span class=\"n\">sock<\/span> <span class=\"o\">==<\/span> <span class=\"n\">serv<\/span><span class=\"p\">:<\/span>\n      <span class=\"n\">sockfd<\/span><span class=\"p\">,<\/span> <span class=\"n\">addr<\/span> <span class=\"o\">=<\/span> <span class=\"n\">serv<\/span><span class=\"p\">.<\/span><span class=\"n\">accept<\/span><span class=\"p\">()<\/span>\n      <span class=\"n\">LIST<\/span><span class=\"p\">.<\/span><span class=\"n\">append<\/span><span class=\"p\">(<\/span><span class=\"n\">sockfd<\/span><span class=\"p\">)<\/span>\n    <span class=\"c1\"># Naah, just a new message!\n<\/span>    <span class=\"k\">else<\/span><span class=\"p\">:<\/span>\n      <span class=\"k\">try<\/span><span class=\"p\">:<\/span>\n        <span class=\"c1\"># Get his shitty message.\n<\/span>        <span class=\"n\">data<\/span> <span class=\"o\">=<\/span> <span class=\"n\">sock<\/span><span class=\"p\">.<\/span><span class=\"n\">recv<\/span><span class=\"p\">(<\/span><span class=\"n\">buff<\/span><span class=\"p\">)<\/span>\n        <span class=\"k\">if<\/span> <span class=\"n\">data<\/span><span class=\"p\">:<\/span>\n          <span class=\"c1\"># If he wrote something, send it to shout() function for broadcast.\n<\/span>          <span class=\"n\">shout<\/span><span class=\"p\">(<\/span><span class=\"n\">sock<\/span><span class=\"p\">,<\/span> <span class=\"n\">data<\/span><span class=\"p\">)<\/span>\n      <span class=\"p\"&gt;;<\/span><span class=\"k\">except<\/span><span class=\"p\">:<\/span>\n        <span class=\"c1\"># Shit just got real. Client kicked by server :3\n<\/span>        <span class=\"n\">sock<\/span><span class=\"p\">.<\/span><span class=\"n\">close<\/span><span class=\"p\">()<\/span>\n        <span class=\"n\">LIST<\/span><span class=\"p\">.<\/span><span class=\"n\">remove<\/span><span class=\"p\">(<\/span><span class=\"n\">sock<\/span><span class=\"p\">)<\/span>\n        <span class=\"c1\"># Do this till the end of time.\n<\/span>        <span class=\"k\">continue<\/span>\n<span class=\"n\">serv<\/span><span class=\"p\">.<\/span><span class=\"n\">close<\/span><span class=\"p\">()<\/span><\/code><\/pre>\n<\/figure>\n<h4>client.py <\/h4>\n<figure class=\"highlight\">\n<pre><code class=\"language-python\" data-lang=\"python\"><span class=\"c1\"># Import the nessary libraries\n<\/span><span class=\"kn\">import<\/span> <span class=\"nn\">socket<\/span>\n<span class=\"kn\">import<\/span> <span class=\"nn\">string<\/span>\n<span class=\"kn\">import<\/span> <span class=\"nn\">select<\/span>\n<span class=\"kn\">import<\/span> <span class=\"nn\">sys<\/span>\n\n<span class=\"c1\"># Socket variable declaration\n<\/span><span class=\"n\">s<\/span> <span class=\"o\">=<\/span> <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">socket<\/span><span class=\"p\">(<\/span><span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">AF_INET<\/span><span class=\"p\">,<\/span> <span class=\"n\">socket<\/span><span class=\"p\">.<\/span><span class=\"n\">SOCK_STREAM<\/span><span class=\"p\">)<\/span>\n<span class=\"n\">s<\/span><span class=\"p\">.<\/span><span class=\"n\">settimeout<\/span><span class=\"p\">(<\/span><span class=\"mi\">2<\/span><span class=\"p\">)<\/span>\n\n<span class=\"c1\"># Connect to server. Change this for remote servers.\n<\/span><span class=\"n\">s<\/span><span class=\"p\">.<\/span><span class=\"n\">connect<\/span><span class=\"p\">((<\/span><span class=\"s\">\"192.168.1.10\"<\/span><span class=\"p\">,<\/span> <span class=\"mi\">1356<\/span><span class=\"p\">))<\/span>\n\n<span class=\"c1\"># A prompt asking client to enter something.\n<\/span><span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">write<\/span><span class=\"p\">(<\/span><span class=\"s\">\"&gt;\"<\/span><span class=\"p\">)<\/span>\n<span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">flush<\/span><span class=\"p\">()<\/span>\n\n<span class=\"k\">while<\/span> <span class=\"mi\">1<\/span><span class=\"p\">:<\/span>\n  <span class=\"c1\"># These are the possible events.\n<\/span>  <span class=\"c1\"># sys.stdin --&gt; Client has typed something through keyboard.\n<\/span>  <span class=\"c1\"># s --&gt; Server has send a new message by some other client you.\n<\/span>  <span class=\"n\">streams<\/span> <span class=\"o\">=<\/span> <span class=\"p\">[<\/span><span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdin<\/span><span class=\"p\">,<\/span> <span class=\"n\">s<\/span><span class=\"p\">]<\/span>\n\n  <span class=\"c1\"># Moniter both the streams simultaneously for inputs.\n<\/span>  <span class=\"n\">readable<\/span><span class=\"p\">,<\/span> <span class=\"n\">writable<\/span><span class=\"p\">,<\/span> <span class=\"n\">err<\/span> <span class=\"o\">=<\/span> <span class=\"n\">select<\/span><span class=\"p\">.<\/span><span class=\"n\">select<\/span><span class=\"p\">(<\/span><span class=\"n\">streams<\/span><span class=\"p\">,<\/span> <span class=\"p\">[],<\/span> <span class=\"p\">[])<\/span>\n\n  <span class=\"c1\"># If server has sent something, readable will fill up.\n<\/span>  <span class=\"k\">for<\/span> <span class=\"n\">sock<\/span> <span class=\"ow\">in<\/span> <span class=\"n\">readable<\/span><span class=\"p\">:<\/span>\n    <span class=\"k\">if<\/span> <span class=\"n\">sock<\/span> <span class=\"o\">==<\/span> <span class=\"n\">s<\/span><span class=\"p\">:<\/span>\n\n      <span class=\"c1\"># Receive data in our variable. Check if it is empty.\n<\/span>      <span class=\"n\">data<\/span> <span class=\"o\">=<\/span> <span class=\"n\">sock<\/span><span class=\"p\">.<\/span><span class=\"n\">recv<\/span><span class=\"p\">(<\/span><span class=\"mi\">1024<\/span><span class=\"p\">)<\/span>\n      <span class=\"k\">if<\/span> <span class=\"ow\">not<\/span> <span class=\"n\">data<\/span><span class=\"p\">:<\/span>\n        <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"nb\">exit<\/span><span class=\"p\">()<\/span>\n      <span class=\"k\">else<\/span><span class=\"p\">:<\/span>\n\n        <span class=\"c1\"># Write data to stdout and give client prompt back.\n<\/span>        <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">write<\/span><span class=\"p\">(<\/span><span class=\"n\">data<\/span><span class=\"p\">)<\/span>\n        <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">write<\/span><span class=\"p\">(<\/span><span class=\"s\">\"&gt;\"<\/span><span class=\"p\">)<\/span>\n        <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">flush<\/span><span class=\"p\">()<\/span>\n\n    <span class=\"c1\"># No, its not the server. Our client has typed something in.\n<\/span>    <span class=\"k\">else<\/span><span class=\"p\">:<\/span>\n\n      <span class=\"c1\"># Read message. Send it to server. Give prompt back to client.\n<\/span>      <span class=\"n\">msg<\/span> <span class=\"o\">=<\/span> <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdin<\/span><span class=\"p\">.<\/span><span class=\"n\">readline<\/span><span class=\"p\">()<\/span>\n      <span class=\"n\">s<\/span><span class=\"p\">.<\/span><span class=\"n\">send<\/span><span class=\"p\">(<\/span><span class=\"n\">msg<\/span><span class=\"p\">)<\/span>\n      <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">write<\/span><span class=\"p\">(<\/span><span class=\"s\">\"&gt;\"<\/span><span class=\"p\">)<\/span>\n      <span class=\"n\">sys<\/span><span class=\"p\">.<\/span><span class=\"n\">stdout<\/span><span class=\"p\">.<\/span><span class=\"n\">flush<\/span><span class=\"p\">()<\/span><\/code><\/pre>\n<\/figure>\n<p>\n  So that was the code. Here is a glimpse of the output. The server is running off my &#8216;raspberrypi&#8217; and all clients are running on my computer. Looks cool right?\n<\/p>\n<p><a href=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2020\/12\/python_server.png\"><img decoding=\"async\" src=\"https:\/\/www.nagekar.com\/wp-content\/uploads\/2020\/12\/python_server.png\"\/><\/a><\/p>\n<p>\n  If you look closely, one of the clients missed a message sent by another client, LOL, so that is normal. Any suggestions or edits or corrections, drop them in the comments below. \ud83d\ude42<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Aaaaannd here is another post of mine on sockets, client\/server models and stuff. I suppose you have started to get bored by the same stuff everyday right? Seems like I just can&#8217;t get enough of this thing. But trust me, I had no intention of doing this today, a friend of mine instigated me write [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":838,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[],"tags":[4,18],"class_list":["post-1167","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","tag-python","tag-socket"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1167","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1167"}],"version-history":[{"count":0,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1167\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media\/838"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1167"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1167"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1167"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}