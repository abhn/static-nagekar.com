{"id":1170,"date":"2014-11-29T23:00:00","date_gmt":"2014-11-29T23:00:00","guid":{"rendered":"http:\/\/wp.nagekar.com\/2014\/11\/29\/simple-tcp-banner-grabber-in-c\/"},"modified":"2014-11-29T23:00:00","modified_gmt":"2014-11-29T23:00:00","slug":"simple-tcp-banner-grabber-in-c","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2014\/11\/simple-tcp-banner-grabber-in-c.html","title":{"rendered":"Simple TCP banner grabber in C"},"content":{"rendered":"<div dir=\"ltr\" style=\"text-align: left;\" trbidi=\"on\">Hello folks, Its been a great week. I got the book called Expert C Programming &#8211; Deep C Secrets, by Peter van der Linden. I read about 100 pages in a couple of days, and I had never gained so much confidence reading any other book. Many concepts got sharper, doubts cleared and confidence boasted. A must read book if you know some C and want to understand the nuts and bolts of it.<\/p>\n<p>In the same wave, I decided to write a small utility with sockets later today. It went great. Lots of coding, googling (I just can&#8217;t code without Google, maybe a sign of newbie) and debuging. Finally I ended up having a program that was partially correct. It works, but it doesn&#8217;t. It actually does more than what is told, and I couldn&#8217;t find out why. Still, I am posting it here, for those interested. Please correct it, as I didn&#8217;t really get what is wrong with it. Looks like some of the array locations are interpreted as ports, in the &#8216;ports&#8217; array.<\/p>\n<p>usage example: .\/scanner 192.168.1.2 22,80,443<\/p>\n<blockquote class=\"tr_bq\"><p>&nbsp;root@kali:~\/Desktop\/C\/socket# .\/client 192.168.1.10 22,80<\/p><\/blockquote>\n<blockquote class=\"tr_bq\"><p>[+]Testing port: 22<br \/>[*]SSH-2.0-OpenSSH_6.0p1 Debian-4<\/p>\n<p>[+]Testing port: 80<br \/>[*]&lt;!DOCTYPE HTML PUBLIC &#8220;-\/\/IETF\/\/DTD H<\/p><\/blockquote>\n<blockquote><p>TML 2.0\/\/EN&#8221;&gt;<br \/>&lt;html&gt;&lt;head&gt;<br \/>&lt;title&gt;501 Method Not Implemented&lt;\/title&gt;<br \/>&lt;\/head&gt;&lt;body&gt;<br \/>&lt;h1&gt;Method Not Implemented&lt;\/h1&gt;<br \/>&lt;p&gt;garbage to \/index.html not supported.&lt;br \/&gt;<br \/>&lt;\/p&gt;<br \/>&lt;hr&gt;<br \/>&lt;address&gt;Apache\/2.2.22 (Debian) Server at 127.0.1.1 Port 80&lt;\/address&gt;<br \/>&lt;\/body&gt;&lt;\/html&gt;<\/p>\n<p>[+]Testing port: 4195840<br \/>[-]Error Connecting to port<\/p>\n<p>[+]Testing port: 0<br \/>[-]Error Connecting to port<\/p>\n<p>[+]Testing port: 1476291006<br \/>[-]Error Connecting to port<\/p>\n<p>[+]Testing port: 32767<br \/>[-]Error Connecting to port<\/p><\/blockquote>\n<p>I am not sure what that is, the part after the actual banner I mean. I will update this article as soon I get things sorted. Here is the code, if anyone wants to have a look.<\/p>\n<pre class=\"brush: cpp\">#include &lt;stdio.h&gt;<br \/>#include &lt;stdlib.h&gt;<br \/>#include &lt;unistd.h&gt;<br \/>#include &lt;string.h&gt;<br \/>#include &lt;sys\/types.h&gt;<br \/>#include &lt;sys\/socket.h&gt;<br \/>#include &lt;netinet\/in.h&gt;<br \/>#include &lt;netdb.h&gt;<br \/> <br \/>void scanner(int port, char host[]);<br \/> <br \/>int main(int argc, char **argv) {<br \/> char host[100];<br \/> char *p;<br \/> int ports[10];<br \/> int i = 0;<br \/> int var;<br \/> char tok[] = \" ,\";<br \/>  <br \/> if (argc &lt; 2) {<br \/>       fprintf(stderr,\"[+]usage: %s &lt;hostname&gt; &lt;port,port,port...&gt;n\", argv[0]);<br \/>       exit(0);<br \/>    }<br \/>     <br \/>    p = strtok(argv[2], tok);<br \/>    strcpy(host, argv[1]);<br \/> while(p != NULL) {<br \/>  sscanf(p, \"%d\", &amp;var);<br \/>  ports[i++] = var;<br \/>  p = strtok(NULL, tok);<br \/> }<br \/>  <br \/> for(i=0; i&lt;(sizeof(ports)\/sizeof(ports[0])); i++) {<br \/>  fprintf(stdout, \"n[+]Testing port: %dn\", ports[i]);<br \/>  scanner(ports[i], host);<br \/> }<br \/> return 0;<br \/>}<br \/> <br \/>void scanner(int port, char host[]) {<br \/> <br \/> int sock, n;<br \/>    struct hostent *server;<br \/>    struct sockaddr_in serv_addr;<br \/>     <br \/>    char buffer[4096];<br \/>  <br \/>    server = gethostbyname(host);<br \/>     <br \/> sock = socket(AF_INET, SOCK_STREAM, 0);<br \/> \/* Edit the params of socket to scan UDP ports,<br \/>  * should be pretty straight forward I suppose.<br \/>  *\/<br \/>   <br \/> if(sock &lt; 0) {<br \/>  fprintf(stderr, \"[-]Error creating socket\");<br \/>  return;<br \/> }<br \/>  <br \/> bzero((char *) &amp;serv_addr, sizeof(serv_addr));<br \/> serv_addr.sin_family = AF_INET;<br \/> \/\/ AF_UNIX for Unix style socket<br \/>  <br \/> bcopy((char *)server-&gt;h_addr, (char *)&amp;serv_addr.sin_addr.s_addr, server-&gt;h_length);<br \/> serv_addr.sin_port = htons(port);<br \/>  <br \/> n = connect(sock, (struct sockaddr *)&amp;serv_addr, sizeof(serv_addr));<br \/> sleep(2);<br \/> if(n &lt; 0) {<br \/>  fprintf(stderr, \"[-]Error Connecting to portn\");<br \/>  return;<br \/> }<br \/>  <br \/> memset(buffer, 0, sizeof(buffer));<br \/> strcpy(buffer, \"garbagern\");<br \/>  <br \/> n = write(sock, buffer, strlen(buffer));<br \/> if(n &lt; 0) {<br \/>  fprintf(stderr, \"[-]Error writing (Port closed maybe?!)n\");<br \/>  return;<br \/> }<br \/>  <br \/> bzero(buffer, 4096);<br \/> n = read(sock, buffer, 4096);<br \/> if(n &lt; 0) {<br \/>  fprintf(stderr, \"[-]Error reading (Port closed maybe?!)n\");<br \/>  return;<br \/> }<br \/>  <br \/> fprintf(stdout,\"[*]%sn\", buffer);<br \/> close(sock);<br \/>     <br \/>}<br \/><\/pre>\n<\/div>\n","protected":false},"excerpt":{"rendered":"<p>Hello folks, Its been a great week. I got the book called Expert C Programming &#8211; Deep C Secrets, by Peter van der Linden. I read about 100 pages in a couple of days, and I had never gained so much confidence reading any other book. Many concepts got sharper, doubts cleared and confidence boasted. [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[],"tags":[17,18],"class_list":["post-1170","post","type-post","status-publish","format-standard","hentry","tag-c","tag-socket"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1170","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1170"}],"version-history":[{"count":0,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1170\/revisions"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1170"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1170"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1170"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}