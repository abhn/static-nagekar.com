{"id":1992,"date":"2023-09-09T01:51:38","date_gmt":"2023-09-08T23:51:38","guid":{"rendered":"https:\/\/nagekar.com\/?p=1992"},"modified":"2023-09-09T01:51:38","modified_gmt":"2023-09-08T23:51:38","slug":"trying-cloudflares-automatic-platform-optimization","status":"publish","type":"post","link":"https:\/\/nagekar.com\/2023\/09\/trying-cloudflares-automatic-platform-optimization.html","title":{"rendered":"Trying Cloudflare&#8217;s Automatic Platform Optimization"},"content":{"rendered":"\n<p>If you&#8217;ve looked at this <a href=\"https:\/\/github.com\/abhn\/Elementary\">blog&#8217;s theme repository<\/a>, it wouldn&#8217;t surprise you when I say I&#8217;m obsessed with website performance optimization. <\/p>\n\n\n\n<p>I admit that it almost feels like cheating boasting about performance figures of a website that has very few images, much less any other form of media. But that is what I have, so that is what I&#8217;ll try to optimize. <\/p>\n\n\n\n<p>I came across <a href=\"https:\/\/www.cloudflare.com\/lp\/pg-apo\/?\">Cloudflare&#8217;s Automatic Platform Optimization<\/a> a couple of days ago while trying to move my website to a bigger EC2 instance on AWS. I was upgrading the EC2 instance mostly for the admin side of the website, which really struggled with image uploads, but this juicy piece of optimization was too good to not try and apply. At least temporarily.<\/p>\n\n\n\n<h2 class=\"wp-block-heading\">What is Cloudflare&#8217;s Automatic Platform Optimization for WordPress?<\/h2>\n\n\n\n<p>I use Cloudflare for content delivery. Cloudflare, among the plethora of things they currently do (and do well), is a very good CDN. They have a more than adequate free plan for personal websites. For a website like mine, it means the CSS and JavaScript (and the occasional images) get served from a location closest to the visitor via Cloudflare&#8217;s edge network. <\/p>\n\n\n\n<p>The initial request to the HTML file, however, is still served by my origin. There&#8217;s some caching in place so that not every request has to hit the database, but the content is still travelling to the visitor all the way from Frankfurt, Germany.<\/p>\n\n\n\n<p>This is where Cloudflare&#8217;s APO comes in. It allows the entire WordPress website to be cached, including the HTML parts. What that means is that the initial request is served through Cloudflare&#8217;s edge cache and nothing touches my origin server. <\/p>\n\n\n\n<h2 class=\"wp-block-heading\">Setup<\/h2>\n\n\n\n<p>Setup includes buying the appropriate plan on Cloudflare&#8217;s website. At the time of writing it is US$5 \/ month. The setup includes a <a href=\"https:\/\/wordpress.org\/plugins\/cloudflare\/\">WordPress plugin,<\/a> which is fairly simple and minimal in customizability (not like there&#8217;s much to customize here). It does have an option to cache by device type and apparently it can purge caches upon site update, which is neat. <\/p>\n\n\n\n<h2 class=\"wp-block-heading\">How does that look in practice?<\/h2>\n\n\n\n<p>Here&#8217;s an example of what it is that you get for the price. Below is the default duration for the initial document load of my blog&#8217;s homepage. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1810\" height=\"224\" src=\"http:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3.png\" alt=\"\" class=\"wp-image-2009\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3.png 1810w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3-300x37.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3-250x31.png 250w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3-768x95.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-3-1536x190.png 1536w\" sizes=\"auto, (max-width: 1810px) 100vw, 1810px\" \/><\/figure>\n\n\n\n<p>Turning on APO through the included WordPress plugin, we immediately see a huge 10x improvement. I believe at this point my own internet connection might also be a bottleneck. The <code>cf-cache-status: HIT<\/code> suggests that the HTML document was served through Cloudflare&#8217;s cache. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full is-resized\"><img loading=\"lazy\" decoding=\"async\" src=\"http:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2.png\" alt=\"\" class=\"wp-image-2008\" style=\"width:821px;height:98px\" width=\"821\" height=\"98\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2.png 1810w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2-300x36.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2-250x30.png 250w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2-768x92.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-2-1536x183.png 1536w\" sizes=\"auto, (max-width: 821px) 100vw, 821px\" \/><\/figure>\n\n\n\n<p>I am a bit unsure if this is possible to achieve using page rules within the free plan (it does look like it is to some extent), but APO also has the added advantages for WordPress. <\/p>\n\n\n\n<figure class=\"wp-block-image size-full\"><img loading=\"lazy\" decoding=\"async\" width=\"1914\" height=\"1182\" src=\"http:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4.png\" alt=\"\" class=\"wp-image-2010\" srcset=\"https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4.png 1914w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4-300x185.png 300w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4-250x154.png 250w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4-768x474.png 768w, https:\/\/nagekar.com\/wp-content\/uploads\/2023\/09\/image-4-1536x949.png 1536w\" sizes=\"auto, (max-width: 1914px) 100vw, 1914px\" \/><\/figure>\n\n\n\n<h2 class=\"wp-block-heading\">In conclusion<\/h2>\n\n\n\n<p>I admit I don&#8217;t really need this optimization. My blog already <a href=\"https:\/\/pagespeed.web.dev\/analysis?url=http%3A%2F%2Fnagekar.com%2F\">scores full points<\/a> on many website performance measurement tools (low-key proud writing this). I also admit that I find it extremely cool to do such things. In any case, hope the article was interesting. Thank you for reading.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>If you&#8217;ve looked at this blog&#8217;s theme repository, it wouldn&#8217;t surprise you when I say I&#8217;m obsessed with website performance optimization. I admit that it almost feels like cheating boasting about performance figures of a website that has very few images, much less any other form of media. But that is what I have, so [&hellip;]<\/p>\n","protected":false},"author":2,"featured_media":0,"comment_status":"closed","ping_status":"","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[1],"tags":[],"class_list":["post-1992","post","type-post","status-publish","format-standard","hentry","category-uncategorized"],"_links":{"self":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1992","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/users\/2"}],"replies":[{"embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/comments?post=1992"}],"version-history":[{"count":4,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1992\/revisions"}],"predecessor-version":[{"id":2012,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/posts\/1992\/revisions\/2012"}],"wp:attachment":[{"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/media?parent=1992"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/categories?post=1992"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/nagekar.com\/wp-json\/wp\/v2\/tags?post=1992"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}